<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>2023/01/26 on</title><link>https://ikorihn.github.io/digitalgarden/tags/2023/01/26/</link><description>Recent content in 2023/01/26 on</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><atom:link href="https://ikorihn.github.io/digitalgarden/tags/2023/01/26/index.xml" rel="self" type="application/rss+xml"/><item><title>Kubernetes limitsを指定したPodで動かしているプロセスがメモリ超過してもevictされずプロセスがkillされる</title><link>https://ikorihn.github.io/digitalgarden/note/Kubernetes-limits%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9FPod%E3%81%A7%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%8C%E3%83%A1%E3%83%A2%E3%83%AA%E8%B6%85%E9%81%8E%E3%81%97%E3%81%A6%E3%82%82evict%E3%81%95%E3%82%8C%E3%81%9A%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%8Ckill%E3%81%95%E3%82%8C%E3%82%8B/</link><pubDate>Thu, 26 Jan 2023 15:43:00 +0900</pubDate><guid>https://ikorihn.github.io/digitalgarden/note/Kubernetes-limits%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9FPod%E3%81%A7%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%8C%E3%83%A1%E3%83%A2%E3%83%AA%E8%B6%85%E9%81%8E%E3%81%97%E3%81%A6%E3%82%82evict%E3%81%95%E3%82%8C%E3%81%9A%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%8Ckill%E3%81%95%E3%82%8C%E3%82%8B/</guid><description>kubernetes resourcesの設定値について Kubernetes
command: ['sleep', '3600'] とかで起動したpodにexecで入って yes コマンド等で負荷をかけても、yes のプロセスがkillされるだけでpodはevictされなかった。 ドキュメント読む限りpodがevictされるのかと思ったがそうじゃない？
こちらに書いてあった https://dunkshoot.hatenablog.com/entry/kubernetes_manage_resource#limits-%E3%82%92%E8%B6%85%E3%81%88%E3%81%A6%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E3%83%A1%E3%83%A2%E3%83%AA
起動時のコマンドのプロセスがlimitsに達したとき、podがkillされる(想定通り)
killされた理由がどこかに出力されているのかはわからなかった。 describe pod すると負荷かけたコンテナのほうにOOMKilledが出ているのはわかった
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 apiVersion:apps/v1kind:Deploymentmetadata:name:test-deploymentspec:replicas:1selector:matchLabels:app:test-apptemplate:metadata:labels:app:test-appspec:containers:- name:busybox# こちらはkillされないimage:busybox:latestcommand:[&amp;#39;sh&amp;#39;,&amp;#39;-c&amp;#39;,&amp;#39;echo &amp;#34;Hello, Kubernetes!</description></item></channel></rss>