<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Docker on</title><link>https://ikorihn.github.io/digitalgarden/tags/Docker/</link><description>Recent content in Docker on</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Fri, 05 May 2023 20:23:00 +0900</lastBuildDate><atom:link href="https://ikorihn.github.io/digitalgarden/tags/Docker/index.xml" rel="self" type="application/rss+xml"/><item><title>Dockerfile内で条件分岐する</title><link>https://ikorihn.github.io/digitalgarden/note/Dockerfile%E5%86%85%E3%81%A7%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90%E3%81%99%E3%82%8B/</link><pubDate>Fri, 05 May 2023 20:23:00 +0900</pubDate><guid>https://ikorihn.github.io/digitalgarden/note/Dockerfile%E5%86%85%E3%81%A7%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90%E3%81%99%E3%82%8B/</guid><description>docker - Dockerfile if else condition with external arguments - Stack Overflow Dockerfile 内で条件に応じて処理を変えたかったので試行錯誤したメモ - ようへいの日々精進XP
前提として、Dockerfile内で制御構文は使えない。使わずシンプルにするっていう思想になっている
1. shell scriptで分岐 1 2 3 FROMcentos:7ARG argRUN if [[ -z &amp;#34;$arg&amp;#34; ]] ; then echo Argument not provided ; else echo Argument is $arg ; fi これだとshell内でできることは分岐できるがCOPYなどDockerfile内のコマンドには使えない。</description></item><item><title>Rancher Desktop</title><link>https://ikorihn.github.io/digitalgarden/note/Rancher-Desktop/</link><pubDate>Fri, 05 May 2023 20:19:00 +0900</pubDate><guid>https://ikorihn.github.io/digitalgarden/note/Rancher-Desktop/</guid><description>Docker Desktop 代替候補 lima でLinux Virtual Machine が動いていて、VM上でコンテナランタイム(dockerd、containerd) を動かしている
Kubernetesはk3sで動かすことができる Proxyの設定がない</description></item><item><title>Kaniko assume roleを使ってECRログインする</title><link>https://ikorihn.github.io/digitalgarden/note/Kaniko-assume-role%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6ECR%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%99%E3%82%8B/</link><pubDate>Fri, 10 Feb 2023 16:24:00 +0900</pubDate><guid>https://ikorihn.github.io/digitalgarden/note/Kaniko-assume-role%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6ECR%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%99%E3%82%8B/</guid><description>kaniko が何をしているか, 何ができるか - 薄いブログ Container Image Building with Kaniko
Kaniko Image Cache in Jenkins Kubernetes Agents - Stack Overflow</description></item><item><title>kubernetesクラスタ内にプライベートdockerレジストリを作る</title><link>https://ikorihn.github.io/digitalgarden/note/kubernetes%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%BF%E5%86%85%E3%81%AB%E3%83%97%E3%83%A9%E3%82%A4%E3%83%99%E3%83%BC%E3%83%88docker%E3%83%AC%E3%82%B8%E3%82%B9%E3%83%88%E3%83%AA%E3%82%92%E4%BD%9C%E3%82%8B/</link><pubDate>Wed, 04 Jan 2023 18:44:00 +0900</pubDate><guid>https://ikorihn.github.io/digitalgarden/note/kubernetes%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%BF%E5%86%85%E3%81%AB%E3%83%97%E3%83%A9%E3%82%A4%E3%83%99%E3%83%BC%E3%83%88docker%E3%83%AC%E3%82%B8%E3%82%B9%E3%83%88%E3%83%AA%E3%82%92%E4%BD%9C%E3%82%8B/</guid><description>サンプルだとよくECRやGCRにコンテナイメージをアップロードするように言われるが、とりあえずローカルで確認したいときに、Kubernetesクラスタ内にdockerレジストリを作る方法について調べた。
registryを作成 Using a Local Registry with Minikube
https://hub.docker.com/_/registry を使う
docker-registry.yaml
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 apiVersion:apps/v1kind:Deploymentmetadata:name:docker-registrylabels:app:docker-registryspec:replicas:1selector:matchLabels:app:docker-registrytemplate:metadata:labels:app:docker-registryspec:containers:- name:docker-registryimage:registry:2.</description></item><item><title>Docker build時にhostのsshキーを使う</title><link>https://ikorihn.github.io/digitalgarden/note/Docker-build%E6%99%82%E3%81%ABhost%E3%81%AEssh%E3%82%AD%E3%83%BC%E3%82%92%E4%BD%BF%E3%81%86/</link><pubDate>Thu, 29 Dec 2022 12:06:00 +0900</pubDate><guid>https://ikorihn.github.io/digitalgarden/note/Docker-build%E6%99%82%E3%81%ABhost%E3%81%AEssh%E3%82%AD%E3%83%BC%E3%82%92%E4%BD%BF%E3%81%86/</guid><description>#Docker #git
参考 BuildKit でイメージ構築 — Docker-docs-ja 20.10 ドキュメント docker buildする際にhost側のssh keyを使ってbuildする - Qiita Docker の BuildKit を使ってセキュアなビルドを試す - Qiita</description></item><item><title>dnsmasqをコンテナ内に立ててDNS問い合わせをキャッシュする</title><link>https://ikorihn.github.io/digitalgarden/note/dnsmasq%E3%82%92%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E5%86%85%E3%81%AB%E7%AB%8B%E3%81%A6%E3%81%A6DNS%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B%E3%82%92%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%99%E3%82%8B/</link><pubDate>Wed, 07 Dec 2022 12:37:00 +0900</pubDate><guid>https://ikorihn.github.io/digitalgarden/note/dnsmasq%E3%82%92%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E5%86%85%E3%81%AB%E7%AB%8B%E3%81%A6%E3%81%A6DNS%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B%E3%82%92%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%99%E3%82%8B/</guid><description>dnsmasq は小規模なネットワーク向けのDNS、DHCPサーバー。 DNSのキャッシュくらい、デフォルトであるものだと思っていたけどLinuxはそうではないようなので、こういうソフトウェアを入れてキャッシュさせる
yum でインストールして、設定ファイルを書き換える
dnsmasqをインストールすると、 /etc/dnsmasq.conf という設定ファイルが生成されるので、コメントアウトを外す とりあえず以下を設定する
1 2 3 domain-needed #ドメインの無いホスト名のみ問い合わせの場合、上位DNSサーバに転送しない bogus-priv #プライベートIPアドレスの逆引きを上位DNSサーバに転送しない resolv-file #上位DNSサーバの設定 1 2 3 4 5 6 7 8 9 FROMamazonlinux:2RUN yum install -y dnsmasq systemdRUN echo &amp;#39;nameserver 8.</description></item><item><title>Node.js npm installを早くしたい</title><link>https://ikorihn.github.io/digitalgarden/note/Node.js-npm-install%E3%82%92%E6%97%A9%E3%81%8F%E3%81%97%E3%81%9F%E3%81%84/</link><pubDate>Thu, 27 Oct 2022 18:42:00 +0900</pubDate><guid>https://ikorihn.github.io/digitalgarden/note/Node.js-npm-install%E3%82%92%E6%97%A9%E3%81%8F%E3%81%97%E3%81%9F%E3%81%84/</guid><description>#Nodejs #Docker
依存関係解決を早くしたい npm ci を使う
CI/CDでnpm ciする際は ~/.npm をキャッシュしよう | DevelopersIO npm ciを使おう あるいはより速く - Qiita
package-lock.json のみを見て依存関係解決する(npm install は package.</description></item><item><title>Alpineにglibcをインストールする</title><link>https://ikorihn.github.io/digitalgarden/note/Alpine%E3%81%ABglibc%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B/</link><pubDate>Mon, 22 Aug 2022 12:53:00 +0900</pubDate><guid>https://ikorihn.github.io/digitalgarden/note/Alpine%E3%81%ABglibc%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B/</guid><description>#Docker
Alpine Linuxにインストールされているのは glibc ではなくて musl-libc なので、適当にソフトウェアをインストールしても動かないということがたびたび発生する。 例: AWS CLI v2、Androidのビルド
glibcをalpineにインストールする sgerrand/alpine-pkg-glibc: A glibc compatibility layer package for Alpine Linux をインストールする。 基本的にはREADMEの通りに。</description></item><item><title>alpineでAndroidアプリをビルドするイメージを作成</title><link>https://ikorihn.github.io/digitalgarden/note/alpine%E3%81%A7Android%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E3%83%93%E3%83%AB%E3%83%89%E3%81%99%E3%82%8B%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%9C%E6%88%90/</link><pubDate>Tue, 05 Jul 2022 18:10:00 +0900</pubDate><guid>https://ikorihn.github.io/digitalgarden/note/alpine%E3%81%A7Android%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E3%83%93%E3%83%AB%E3%83%89%E3%81%99%E3%82%8B%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%9C%E6%88%90/</guid><description>#Docker
やったこと 以下を参考にDockerfileを作成
Androidのビルド用Dockerイメージダイエット計画 - dely tech blog Androidアプリのビルド環境Dockerイメージ制作 - Qiita DockerでAndroidアプリのビルド環境を作る - Qiita
Android SDKをインストールしたコンテナを公開してしまうとライセンス違反になるので公開はしない ベースイメージはalpineをつかいサイズを小さくする glibcをインストール sgerrand/alpine-pkg-glibc: A glibc compatibility layer package for Alpine Linux</description></item></channel></rss>