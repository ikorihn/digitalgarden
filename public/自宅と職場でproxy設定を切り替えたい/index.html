<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="出社時と在宅時で、プロキシの接続情報を変更する必要がある。 手で切り替えるのを忘れて社内システムにつながらない…ということがよく発生するので、自動化することにした。
切り替えたい対象  プロキシ設定 git proxyの設定を環境に応じて変更  実現方法  proxy.pac をローカルのhttpサーバーで配布 Macのネットワーク設定 > Location で自宅と職場でproxy.pacのURLをそれぞれ設定 git proxyをset,unsetするコマンドを実行 wifiのSSIDが家か職場を判定して分岐する トリガーはスリープからの復帰時  プロキシ設定について プロキシの設定はproxy."><meta property="og:title" content="自宅と職場でproxy設定を切り替えたい"><meta property="og:description" content="出社時と在宅時で、プロキシの接続情報を変更する必要がある。 手で切り替えるのを忘れて社内システムにつながらない…ということがよく発生するので、自動化することにした。
切り替えたい対象  プロキシ設定 git proxyの設定を環境に応じて変更  実現方法  proxy.pac をローカルのhttpサーバーで配布 Macのネットワーク設定 > Location で自宅と職場でproxy.pacのURLをそれぞれ設定 git proxyをset,unsetするコマンドを実行 wifiのSSIDが家か職場を判定して分岐する トリガーはスリープからの復帰時  プロキシ設定について プロキシの設定はproxy."><meta property="og:type" content="website"><meta property="og:image" content="https://ikorihn.github.io/digitalgarden/icon.png"><meta property="og:url" content="https://ikorihn.github.io/digitalgarden/public/%E8%87%AA%E5%AE%85%E3%81%A8%E8%81%B7%E5%A0%B4%E3%81%A7proxy%E8%A8%AD%E5%AE%9A%E3%82%92%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%81%9F%E3%81%84/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="自宅と職場でproxy設定を切り替えたい"><meta name=twitter:description content="出社時と在宅時で、プロキシの接続情報を変更する必要がある。 手で切り替えるのを忘れて社内システムにつながらない…ということがよく発生するので、自動化することにした。
切り替えたい対象  プロキシ設定 git proxyの設定を環境に応じて変更  実現方法  proxy.pac をローカルのhttpサーバーで配布 Macのネットワーク設定 > Location で自宅と職場でproxy.pacのURLをそれぞれ設定 git proxyをset,unsetするコマンドを実行 wifiのSSIDが家か職場を判定して分岐する トリガーはスリープからの復帰時  プロキシ設定について プロキシの設定はproxy."><meta name=twitter:image content="https://ikorihn.github.io/digitalgarden/icon.png"><meta name=twitter:site content="r57ty7"><title>自宅と職場でproxy設定を切り替えたい | ikorihn Digitalgarden</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://ikorihn.github.io/digitalgarden//icon.png><link href=https://ikorihn.github.io/digitalgarden/styles.d2e4b7f83dae8f1042fb202ebb04297c.min.css rel=stylesheet><link href=https://ikorihn.github.io/digitalgarden/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://ikorihn.github.io/digitalgarden/js/darkmode.816c8b542b7f85a3e1f19a1c05a2cabd.min.js></script>
<script src=https://ikorihn.github.io/digitalgarden/js/util.00639692264b21bc3ee219733d38a8be.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script defer src=https://ikorihn.github.io/digitalgarden/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://ikorihn.github.io/digitalgarden/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://ikorihn.github.io/digitalgarden/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://ikorihn.github.io/digitalgarden/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://ikorihn.github.io/digitalgarden/",fetchData=Promise.all([fetch("https://ikorihn.github.io/digitalgarden/indices/linkIndex.7bf57b7507bb5480a292251a98b27afa.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://ikorihn.github.io/digitalgarden/indices/contentIndex.360eed9fea841dd3ad57d7eb617caf67.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://ikorihn.github.io/digitalgarden",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://ikorihn.github.io/digitalgarden",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'’':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/ikorihn.github.io\/digitalgarden\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=ikorihn.github.io/digitalgarden src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://ikorihn.github.io/digitalgarden/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://ikorihn.github.io/digitalgarden/>ikorihn Digitalgarden</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><div class=container><main><article><h1>自宅と職場でproxy設定を切り替えたい</h1><p class=meta>&#x1f4c5; 2021-10-08
(Last updated: 2021-10-08)</p><ul class=tags><li><a href=https://ikorihn.github.io/digitalgarden/tags/Mac/>Mac</a></li><li><a href=https://ikorihn.github.io/digitalgarden/tags/Network/>Network</a></li><li><a href=https://ikorihn.github.io/digitalgarden/tags/shell/>shell</a></li></ul><aside class=mainTOC><details open><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#切り替えたい対象>切り替えたい対象</a></li><li><a href=#実現方法>実現方法</a><ol><li><a href=#プロキシ設定について>プロキシ設定について</a></li></ol></li><li><a href=#proxypacをローカルのhttpサーバーで配布>proxy.pacをローカルのhttpサーバーで配布</a><ol><li><a href=#httpdをインストール自動起動>httpdをインストール、自動起動</a></li><li><a href=#proxypacを配置>proxy.pacを配置</a></li></ol></li><li><a href=#macのネットワーク設定--location-で自宅と職場でproxypacのurlをそれぞれ設定>Macのネットワーク設定 > Location で自宅と職場でproxy.pacのURLをそれぞれ設定</a></li><li><a href=#ネットワーク切り替え時に実行するスクリプトを作成>ネットワーク切り替え時に実行するスクリプトを作成</a></li><li><a href=#sleep復帰時にスクリプトを実行する>sleep復帰時にスクリプトを実行する</a><ol><li><a href=#sleepwatcherをインストール>sleepwatcherをインストール</a></li><li><a href=#plistファイルを作成する>plistファイルを作成する</a></li><li><a href=#launchdに登録>launchdに登録</a></li></ol></li><li><a href=#参考>参考</a></li></ol></nav></details></aside><p>出社時と在宅時で、プロキシの接続情報を変更する必要がある。
手で切り替えるのを忘れて社内システムにつながらない…ということがよく発生するので、自動化することにした。</p><a href=#切り替えたい対象><h2 id=切り替えたい対象><span class=hanchor arialabel=Anchor># </span>切り替えたい対象</h2></a><ul><li>プロキシ設定</li><li>git proxyの設定を環境に応じて変更</li></ul><a href=#実現方法><h2 id=実現方法><span class=hanchor arialabel=Anchor># </span>実現方法</h2></a><ul><li>proxy.pac をローカルのhttpサーバーで配布</li><li>Macのネットワーク設定 > Location で自宅と職場でproxy.pacのURLをそれぞれ設定</li><li>git proxyをset,unsetするコマンドを実行</li><li>wifiのSSIDが家か職場を判定して分岐する</li><li>トリガーはスリープからの復帰時</li></ul><a href=#プロキシ設定について><h3 id=プロキシ設定について><span class=hanchor arialabel=Anchor># </span>プロキシ設定について</h3></a><p>プロキシの設定はproxy.pacを使って行う。
職場では社内で配布されるproxy.pacのURLを入力すればいいが、
自宅では、自前のproxy.pacを作って設定したい。</p><p>しかし、Mojaveからローカルのproxy.pacを <code>file://</code> で設定することができなくなった</p><p><a href=https://qiita.com/orange634nty/items/9ef5cadd039592e8344a rel=noopener>macOS 10.14 Mojave 以降で pac ファイルを使って proxy の設定を行いたいけど出来なかった話 - Qiita</a></p><blockquote><a href=#deprecations><h4 id=deprecations><span class=hanchor arialabel=Anchor># </span>Deprecations</h4></a><p>The <code>ftp://</code> and <code>file://</code> URL schemes for Proxy Automatic Configuration (PAC) are deprecated. HTTP and HTTPS are the only supported URL schemes for PAC. This affects all PAC configurations including, but not limited to, configurations set via Settings, System Preferences, profiles, and
<a href=https://developer.apple.com/documentation/foundation/urlsession rel=noopener><code>URLSession</code></a> APIs such as
<a href=https://developer.apple.com/documentation/foundation/urlsessionconfiguration/1411499-connectionproxydictionary rel=noopener><code>connectionProxyDictionary</code></a>, and
<a href=https://developer.apple.com/documentation/cfnetwork/1426392-cfnetworkexecuteproxyautoconfigu rel=noopener><code>CFNetworkExecuteProxyAutoConfigurationURL(_:_:_:_:)</code></a>. (37811761)</p></blockquote><p>そのため、ローカルにhttpサーバーを立てて <code>http://localhost</code> を設定する方法をとる</p><a href=#proxypacをローカルのhttpサーバーで配布><h2 id=proxypacをローカルのhttpサーバーで配布><span class=hanchor arialabel=Anchor># </span>proxy.pacをローカルのhttpサーバーで配布</h2></a><a href=#httpdをインストール自動起動><h3 id=httpdをインストール自動起動><span class=hanchor arialabel=Anchor># </span>httpdをインストール、自動起動</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ brew install httpd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># M1 Macの場合 /opt/homebrew/etc に設定ファイルがある</span>
</span></span><span class=line><span class=cl>$ vim /opt/homebrew/etc/httpd/httpd.conf
</span></span><span class=line><span class=cl><span class=o>=</span>&gt; Listenポートを任意に設定する<span class=o>(</span>私は80に設定<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ brew services start <span class=nv>httpd</span>
</span></span><span class=line><span class=cl><span class=o>==</span>&gt; Successfully started <span class=sb>`</span>httpd<span class=sb>`</span> <span class=o>(</span>label: homebrew.mxcl.httpd<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># `brew services start` するとlaunchdに登録され、自動起動するようになる (`brew services stop` すると停止、自動起動も解除される)</span>
</span></span><span class=line><span class=cl>$ launchctl list <span class=p>|</span> rg brew
</span></span><span class=line><span class=cl><span class=m>63000</span>   <span class=m>0</span>       homebrew.mxcl.httpd
</span></span><span class=line><span class=cl>$ cat ~/Library/LaunchAgents/homebrew.mxcl.httpd.plist
</span></span><span class=line><span class=cl>&lt;?xml <span class=nv>version</span><span class=o>=</span><span class=s2>&#34;1.0&#34;</span> <span class=nv>encoding</span><span class=o>=</span><span class=s2>&#34;UTF-8&#34;</span>?&gt;
</span></span><span class=line><span class=cl>&lt;!DOCTYPE plist PUBLIC <span class=s2>&#34;-//Apple//DTD PLIST 1.0//EN&#34;</span> <span class=s2>&#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;</span>&gt;
</span></span><span class=line><span class=cl>&lt;plist <span class=nv>version</span><span class=o>=</span><span class=s2>&#34;1.0&#34;</span>&gt;
</span></span><span class=line><span class=cl>&lt;dict&gt;
</span></span><span class=line><span class=cl>        &lt;key&gt;EnvironmentVariables&lt;/key&gt;
</span></span><span class=line><span class=cl>        &lt;dict&gt;
</span></span><span class=line><span class=cl>                &lt;key&gt;PATH&lt;/key&gt;
</span></span><span class=line><span class=cl>                &lt;string&gt;/opt/homebrew/bin:/opt/homebrew/sbin:/usr/bin:/bin:/usr/sbin:/sbin&lt;/string&gt;
</span></span><span class=line><span class=cl>        &lt;/dict&gt;
</span></span><span class=line><span class=cl>        &lt;key&gt;Label&lt;/key&gt;
</span></span><span class=line><span class=cl>        &lt;string&gt;homebrew.mxcl.httpd&lt;/string&gt;
</span></span><span class=line><span class=cl>        &lt;key&gt;ProgramArguments&lt;/key&gt;
</span></span><span class=line><span class=cl>        &lt;array&gt;
</span></span><span class=line><span class=cl>                &lt;string&gt;/opt/homebrew/opt/httpd/bin/httpd&lt;/string&gt;
</span></span><span class=line><span class=cl>                &lt;string&gt;-D&lt;/string&gt;
</span></span><span class=line><span class=cl>                &lt;string&gt;FOREGROUND&lt;/string&gt;
</span></span><span class=line><span class=cl>        &lt;/array&gt;
</span></span><span class=line><span class=cl>        &lt;key&gt;RunAtLoad&lt;/key&gt;
</span></span><span class=line><span class=cl>        &lt;true/&gt;
</span></span><span class=line><span class=cl>&lt;/dict&gt;
</span></span><span class=line><span class=cl>&lt;/plist&gt;
</span></span></code></pre></td></tr></table></div></div><a href=#proxypacを配置><h3 id=proxypacを配置><span class=hanchor arialabel=Anchor># </span>proxy.pacを配置</h3></a><p><code>/opt/homebrew/var/www/</code> にproxy.pacを置く</p><p><a href=http://localhost/proxy.pac rel=noopener>http://localhost/proxy.pac</a> で取得できるようになる</p><a href=#macのネットワーク設定--location-で自宅と職場でproxypacのurlをそれぞれ設定><h2 id=macのネットワーク設定--location-で自宅と職場でproxypacのurlをそれぞれ設定><span class=hanchor arialabel=Anchor># </span>Macのネットワーク設定 > Location で自宅と職場でproxy.pacのURLをそれぞれ設定</h2></a><p><img src=https://ikorihn.github.io/digitalgarden//public/Pasted-image-20211008123230.png width=auto alt=Pasted-image-20211008123230></p><p>それぞれのLocationで、proxy.pacのURLを入力する</p><p>自宅: <code>http://localhost/proxy.pac</code>
職場: <code>社内のproxy.pacのURL</code>
<img src=https://ikorihn.github.io/digitalgarden//public/Pasted-image-20211008124722.png width=auto alt=Pasted-image-20211008124722></p><a href=#ネットワーク切り替え時に実行するスクリプトを作成><h2 id=ネットワーク切り替え時に実行するスクリプトを作成><span class=hanchor arialabel=Anchor># </span>ネットワーク切り替え時に実行するスクリプトを作成</h2></a><p><a href=/digitalgarden/public/%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AB%E5%BF%9C%E3%81%98%E3%81%A6%E5%87%A6%E7%90%86%E3%82%92%E6%8C%AF%E3%82%8A%E5%88%86%E3%81%91%E3%82%8B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88/ rel=noopener class=internal-link data-src=/digitalgarden/public/%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AB%E5%BF%9C%E3%81%98%E3%81%A6%E5%87%A6%E7%90%86%E3%82%92%E6%8C%AF%E3%82%8A%E5%88%86%E3%81%91%E3%82%8B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88/>ネットワークに応じて処理を振り分けるスクリプト</a></p><a href=#sleep復帰時にスクリプトを実行する><h2 id=sleep復帰時にスクリプトを実行する><span class=hanchor arialabel=Anchor># </span>sleep復帰時にスクリプトを実行する</h2></a><a href=#sleepwatcherをインストール><h3 id=sleepwatcherをインストール><span class=hanchor arialabel=Anchor># </span>sleepwatcherをインストール</h3></a><p><a href=/digitalgarden/public/Mac%E3%82%B9%E3%83%AA%E3%83%BC%E3%83%97%E6%99%82%E5%BE%A9%E5%B8%B0%E6%99%82%E3%81%AB%E5%87%A6%E7%90%86%E3%82%92%E5%8B%95%E3%81%8B%E3%81%99/ rel=noopener class=internal-link data-src=/digitalgarden/public/Mac%E3%82%B9%E3%83%AA%E3%83%BC%E3%83%97%E6%99%82%E5%BE%A9%E5%B8%B0%E6%99%82%E3%81%AB%E5%87%A6%E7%90%86%E3%82%92%E5%8B%95%E3%81%8B%E3%81%99/>Macスリープ時・復帰時に処理を動かす</a></p><p>スリープ前や復帰時にスクリプトを実行できるようになる</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>brew install sleepwatcher
</span></span></code></pre></td></tr></table></div></div><a href=#plistファイルを作成する><h3 id=plistファイルを作成する><span class=hanchor arialabel=Anchor># </span>plistファイルを作成する</h3></a><p><code>~/Library/LaunchAgents</code> 以下にファイルを作成</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span><span class=line><span class=cl>&lt;!DOCTYPE plist PUBLIC &#34;-//Apple Computer//DTD PLIST 1.0//EN&#34; &#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;&gt;
</span></span><span class=line><span class=cl>&lt;plist version=&#34;1.0&#34;&gt;
</span></span><span class=line><span class=cl>&lt;dict&gt;
</span></span><span class=line><span class=cl>    &lt;key&gt;Label&lt;/key&gt;
</span></span><span class=line><span class=cl>    &lt;string&gt;sleepwatcher&lt;/string&gt;
</span></span><span class=line><span class=cl>    &lt;key&gt;ProgramArguments&lt;/key&gt;
</span></span><span class=line><span class=cl>    &lt;array&gt;
</span></span><span class=line><span class=cl>        &lt;string&gt;/usr/local/sbin/sleepwatcher&lt;/string&gt;
</span></span><span class=line><span class=cl>        &lt;string&gt;-V&lt;/string&gt;
</span></span><span class=line><span class=cl>        &lt;string&gt;-w /path/to/switch_location.sh&lt;/string&gt;
</span></span><span class=line><span class=cl>    &lt;/array&gt;
</span></span><span class=line><span class=cl>    &lt;key&gt;RunAtLoad&lt;/key&gt;
</span></span><span class=line><span class=cl>    &lt;true/&gt;
</span></span><span class=line><span class=cl>    &lt;key&gt;KeepAlive&lt;/key&gt;
</span></span><span class=line><span class=cl>    &lt;true/&gt;
</span></span><span class=line><span class=cl>&lt;/dict&gt;
</span></span><span class=line><span class=cl>&lt;/plist&gt;
</span></span></code></pre></td></tr></table></div></div><ul><li><code>-w</code> スリープ復帰（Wake Up）時に実行するコマンド</li><li><code>-s</code> スリープ（Sleep）時に実行するコマンド</li></ul><a href=#launchdに登録><h3 id=launchdに登録><span class=hanchor arialabel=Anchor># </span>launchdに登録</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ launchctl load ~/Library/LaunchAgents/sleepwatcher.plist
</span></span></code></pre></td></tr></table></div></div><a href=#参考><h2 id=参考><span class=hanchor arialabel=Anchor># </span>参考</h2></a><p><a href=https://qiita.com/fiftystorm36/items/5fe936a92445cbf4ad9a rel=noopener>Mac のスリープ／復帰時にスクリプトを実行する - Qiita</a>
<a href=https://log.brdr.jp/post/887 rel=noopener>Macの起動/スリープ復帰時に自動でVPNに接続する / LOG</a>
<a href=https://support.apple.com/ja-jp/HT202480 rel=noopener>Mac でネットワーク環境を使う方法 - Apple サポート (日本)</a>
<a href=https://qiita.com/orange634nty/items/9ef5cadd039592e8344a rel=noopener>macOS 10.14 Mojave 以降で pac ファイルを使って proxy の設定を行いたいけど出来なかった話 - Qiita</a></p></article></main></div><hr><div id=footer><div class=prev-next-container><p>&lt;&lt; <a class=previous href=https://ikorihn.github.io/digitalgarden/public/Mac%E3%82%B9%E3%83%AA%E3%83%BC%E3%83%97%E6%99%82%E5%BE%A9%E5%B8%B0%E6%99%82%E3%81%AB%E5%87%A6%E7%90%86%E3%82%92%E5%8B%95%E3%81%8B%E3%81%99/>Macスリープ時・復帰時に処理を動かす</a></p><p><a class=next href=https://ikorihn.github.io/digitalgarden/public/start-blog-with-gatsby/>Gatsbyでブログを作ったので、構築ログを残す</a> >></p></div><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul><h3>Related pages</h3><h4>Tag: <a href=https://ikorihn.github.io/digitalgarden/tags/Mac/>MAC</a></h4><ul><li><a href=/digitalgarden/note/Raycast/>Raycast</a></li><li><a href=/digitalgarden/note/xcode-select%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%8C%E5%8F%A4%E3%81%84%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E3%81%A7%E3%82%8B/>xcode-selectのバージョンが古いとエラーがでる</a></li><li><a href=/digitalgarden/note/M1-Macbook-Air-%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%972022-03/>M1 Macbook Air セットアップ2022-03</a></li><li><a href=/digitalgarden/public/%E3%83%9E%E3%82%A4%E3%82%AF%E3%81%AE%E3%83%9F%E3%83%A5%E3%83%BC%E3%83%88%E3%82%A2%E3%83%B3%E3%83%9F%E3%83%A5%E3%83%BC%E3%83%88%E3%82%92%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%82%8B/>マイクのミュート・アンミュートを切り替える</a></li><li><a href=/digitalgarden/public/Raycast%E3%81%A7%E3%83%9E%E3%82%A4%E3%82%AF%E3%81%AE%E3%83%9F%E3%83%A5%E3%83%BC%E3%83%88%E3%82%92%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%82%8B/>Raycastでマイクのミュートを切り替える</a></li><li><a href=/digitalgarden/note/terminal%E3%81%8B%E3%82%89%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E8%B5%B7%E5%8B%95%E7%B5%82%E4%BA%86%E3%81%99%E3%82%8B/>terminalからアプリケーションを起動・終了する</a></li><li><a href=/digitalgarden/public/%E8%87%AA%E5%AE%85%E3%81%A8%E8%81%B7%E5%A0%B4%E3%81%A7proxy%E8%A8%AD%E5%AE%9A%E3%82%92%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%81%9F%E3%81%84/>自宅と職場でproxy設定を切り替えたい</a></li><li><a href=/digitalgarden/public/Mac%E3%82%B9%E3%83%AA%E3%83%BC%E3%83%97%E6%99%82%E5%BE%A9%E5%B8%B0%E6%99%82%E3%81%AB%E5%87%A6%E7%90%86%E3%82%92%E5%8B%95%E3%81%8B%E3%81%99/>Macスリープ時・復帰時に処理を動かす</a></li><li><a href=/digitalgarden/note/M1-MacBook-Air/>M1 MacBook Air</a></li><li><a href=/digitalgarden/public/karabiner-elements-recommend/>Karabiner-Elementsで個人的におすすめのキーバインド</a></li></ul><h4>Tag: <a href=https://ikorihn.github.io/digitalgarden/tags/Network/>Network</a></h4><ul><li><a href=/digitalgarden/note/dnsmasq%E3%82%92%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E5%86%85%E3%81%AB%E7%AB%8B%E3%81%A6%E3%81%A6DNS%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B%E3%82%92%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%99%E3%82%8B/>dnsmasqをコンテナ内に立ててDNS問い合わせをキャッシュする</a></li><li><a href=/digitalgarden/public/%E8%87%AA%E5%AE%85%E3%81%A8%E8%81%B7%E5%A0%B4%E3%81%A7proxy%E8%A8%AD%E5%AE%9A%E3%82%92%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%81%9F%E3%81%84/>自宅と職場でproxy設定を切り替えたい</a></li></ul><h4>Tag: <a href=https://ikorihn.github.io/digitalgarden/tags/shell/>Shell</a></h4><ul><li><a href=/digitalgarden/note/shell-script-%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%84JSON%E3%81%A7for-loop%E3%81%99%E3%82%8B%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3/>shell script テキストファイルやJSONでfor loopするパターン</a></li><li><a href=/digitalgarden/note/zsh/>zsh</a></li><li><a href=/digitalgarden/note/ssh-host-key-verification%E3%81%AB%E5%A4%B1%E6%95%97%E3%81%99%E3%82%8B/>ssh host key verificationに失敗する</a></li><li><a href=/digitalgarden/note/yq/>yq</a></li><li><a href=/digitalgarden/note/yq-%E3%83%81%E3%83%BC%E3%83%88%E3%82%B7%E3%83%BC%E3%83%88/>yq チートシート</a></li><li><a href=/digitalgarden/note/ssh-%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%81%A7-su-user-%E3%81%97%E3%81%A6%E3%81%8B%E3%82%89%E6%8E%A5%E7%B6%9A%E3%81%99%E3%82%8Bssh%E5%85%88%E3%82%92sshconfig%E3%81%A7%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B/>ssh 踏み台で su user してから接続するssh先をsshconfigで設定する</a></li><li><a href=/digitalgarden/note/starship/>starship</a></li><li><a href=/digitalgarden/note/Powerlevel10k/>Powerlevel10k</a></li><li><a href=/digitalgarden/note/shell%E3%81%A7while-read%E3%81%AE%E4%B8%AD%E3%81%A7%E5%A4%89%E6%95%B0%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%97%E3%81%A6%E3%82%82%E5%8F%8D%E6%98%A0%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84/>shellでwhile readの中で変数を変更しても反映されない</a></li><li><a href=/digitalgarden/note/jq%E3%81%AE%E9%85%8D%E5%88%97%E3%81%A7%E3%83%AB%E3%83%BC%E3%83%97%E5%87%A6%E7%90%86%E3%82%92%E3%81%99%E3%82%8B/>jqの配列でループ処理をする</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://ikorihn.github.io/digitalgarden/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div></div><div id=contact_buttons><footer><p>Made by ikorihn using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2023</p><ul><li><a href=https://ikorihn.github.io/digitalgarden/>Home</a></li><li><a href=https://twitter.com/r57ty7>Twitter</a></li><li><a href=https://github.com/ikorihn>GitHub</a></li></ul></footer></div></div></body></html>